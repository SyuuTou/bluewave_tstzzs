<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lhjl.tzzs.proxy.mapper.ProjectFinancingLogMapper">
  <resultMap id="BaseResultMap" type="com.lhjl.tzzs.proxy.model.ProjectFinancingLog">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="ID" jdbcType="INTEGER" property="id" />
    <result column="project_id" jdbcType="INTEGER" property="projectId" />
    <result column="financing_time" jdbcType="DATE" property="financingTime" />
    <result column="stage" jdbcType="VARCHAR" property="stage" />
    <result column="amount" jdbcType="DECIMAL" property="amount" />
    <result column="calculation_amount_status" jdbcType="INTEGER" property="calculationAmountStatus" />
    <result column="currency" jdbcType="INTEGER" property="currency" />
    <result column="stock_right" jdbcType="DECIMAL" property="stockRight" />
    <result column="pr_amount" jdbcType="DECIMAL" property="prAmount" />
    <result column="total_amount" jdbcType="DECIMAL" property="totalAmount" />
    <result column="rate" jdbcType="DECIMAL" property="rate" />
    <result column="share_divest" jdbcType="VARCHAR" property="shareDivest" />
    <result column="valuation" jdbcType="DECIMAL" property="valuation" />
    <result column="Investment_institutions_list" jdbcType="VARCHAR" property="investmentInstitutionsList" />
    <result column="proportion_list" jdbcType="VARCHAR" property="proportionList" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="approval_status" jdbcType="INTEGER" property="approvalStatus" />
    <result column="approval_time" jdbcType="TIMESTAMP" property="approvalTime" />
    <result column="amount_status" jdbcType="INTEGER" property="amountStatus" />
    <result column="total_amount_status" jdbcType="INTEGER" property="totalAmountStatus" />
    <result column="financing_time_year" jdbcType="VARCHAR" property="financingTimeYear" />
    <result column="project_financing_useful" jdbcType="VARCHAR" property="projectFinancingUseful" />
    <result column="serial_number" jdbcType="INTEGER" property="serialNumber" />
    <result column="data_soruce_type_id" jdbcType="INTEGER" property="dataSoruceTypeId" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>

  <select id="selectProjectFinancingLogList" parameterType="Integer" resultMap="BaseResultMap">
    select  a.* from( select * from project_financing_log where project_id =  #{projectId} and `status`= #{projectStatus}
    order by financing_time) a
    group by a.stage
    order by a.financing_time desc
  </select>
  <select id="selectInvestors" resultType="String">
    select ii.short_name from investment_institutions_project iip
    left join investment_institutions ii on iip.investment_institutions_id = ii.ID
    where project_id = #{pflid}
    limit 0,3
  </select>
</mapper>