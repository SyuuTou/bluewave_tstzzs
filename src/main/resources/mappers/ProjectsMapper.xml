<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lhjl.tzzs.proxy.mapper.ProjectsMapper">
  <resultMap id="BaseResultMap" type="com.lhjl.tzzs.proxy.model.Projects">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="ID" jdbcType="INTEGER" property="id" />
    <result column="serial_number" jdbcType="INTEGER" property="serialNumber" />
    <result column="short_name" jdbcType="VARCHAR" property="shortName" />
    <result column="full_name" jdbcType="VARCHAR" property="fullName" />
    <result column="kernel_desc" jdbcType="VARCHAR" property="kernelDesc" />
    <result column="commet" jdbcType="VARCHAR" property="commet" />
    <result column="url" jdbcType="VARCHAR" property="url" />
    <result column="established_time" jdbcType="DATE" property="establishedTime" />
    <result column="segmentation" jdbcType="VARCHAR" property="segmentation" />
    <result column="item_label" jdbcType="VARCHAR" property="itemLabel" />
    <result column="address" jdbcType="VARCHAR" property="address" />
    <result column="territory" jdbcType="VARCHAR" property="territory" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="continent" jdbcType="VARCHAR" property="continent" />
    <result column="country" jdbcType="VARCHAR" property="country" />
    <result column="province" jdbcType="VARCHAR" property="province" />
    <result column="city" jdbcType="VARCHAR" property="city" />
    <result column="region" jdbcType="VARCHAR" property="region" />
    <result column="investment_institutions_id" jdbcType="INTEGER" property="investmentInstitutionsId" />
  </resultMap>
  <select id="maxSerialNumber" resultMap="BaseResultMap">
    select * from projects where serial_number between 1000000 and 2000000 order by serial_number desc;
  </select>

  <!-- 用户关注的项目 -->
  <select id="findProjectByUserId" parameterType="String" resultMap="BaseResultMap" >
    SELECT ID,short_name,kernel_desc FROM projects WHERE id IN (SELECT projects_id FROM follow WHERE STATUS=1 AND user_id=#{userId})
  </select>

  <!-- 查询所有的-->
  <select id="findProjectByShortNameAll" resultType="java.util.HashMap">

    SELECT b.*,
    (SELECT COUNT(*) FROM follow a WHERE a.projects_id = b.`ID` AND a.status = 1)num,
    (SELECT MAX(f.status)s FROM follow f WHERE f.user_id = #{userId, jdbcType=VARCHAR} AND f.projects_id = b.`ID` GROUP BY f.projects_id )yn
    FROM projects b
    WHERE short_name LIKE CONCAT('%',#{shortName,jdbcType=VARCHAR},'%')

  </select>
  <select id="findProjectByShortName"  parameterType="String" resultType="java.util.HashMap">
    SELECT b.*,
    (SELECT COUNT(*) FROM follow a WHERE a.projects_id = b.`ID` AND a.status = 1)num,
    (SELECT MAX(f.status)s FROM follow f WHERE f.user_id = #{userId, jdbcType=VARCHAR} AND f.projects_id = b.`ID` GROUP BY f.projects_id )yn
    FROM projects b
    WHERE short_name LIKE CONCAT('%',#{shortName,jdbcType=VARCHAR},'%') LIMIT 3
  </select>

  <select id="findProjectBySview"  parameterType="String" resultType="java.util.HashMap">

    SELECT mf.*,
    (SELECT COUNT(*) FROM follow a WHERE a.projects_id = mf.`ID` AND a.status = 1)num,
    (SELECT MAX(f.status)s FROM follow f WHERE f.user_id = #{userId, jdbcType=VARCHAR} AND f.projects_id = mf.`ID` GROUP BY f.projects_id )yn
    FROM view_projects_info mf where 1=1
    <if test=" type !='' and type != null">
      AND mf.investment_institutions_type = #{type,jdbcType=INTEGER}
    </if>
    <if test="segmentation!= '' and segmentation != null">
      AND mf.segmentation = #{segmentation,jdbcType=VARCHAR}
    </if>
    <if test="stage != '' and stage != null">
      AND mf.stage = #{stage,jdbcType=VARCHAR}
    </if>
    <if test="city != '' and city != null">
      AND mf.city = #{city,jdbcType=VARCHAR}
    </if>
    <if test="working_background_desc != '' and working_background_desc!= null">
      AND mf.working_background_desc = #{working_background_desc,jdbcType=VARCHAR}
    </if>
    <if test="educational_background_desc!= '' and educational_background_desc!= null">
      AND mf.educational_background_desc = #{educational_background_desc,jdbcType=VARCHAR}
    </if>
  </select>
</mapper>